package jdbc.postgress;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Statement;

import com.vividsolutions.jts.geom.Coordinate;
import com.vividsolutions.jts.geom.Geometry;
import com.vividsolutions.jts.geom.GeometryFactory;

import broker.to.Dumpster;

public class PostgreSQLConnection {
	//jdbc URL
	//jdbc USER
	//jdbc PASSWORD
	

    Statement stmt = null;
    ResultSet rs = null;
    Connection con = null;
    
    public PostgreSQLConnection() throws ClassNotFoundException, SQLException {
    	Class.forName("org.postgresql.Driver");   
    	con = DriverManager.getConnection(url, user, password);
    }
	
	private final String url = "jdbc:postgresql://localhost:5432/iot_garbagecollection?currentSchema=public";
	private final String user = "postgres";
	private final String password = "root";
	
	public void searchDevID(String devId)
		    throws SQLException {

		    String query = "select * from dumpster where device_id = '"+ devId + "'";
		    try {
		        stmt = con.createStatement();
		        rs = stmt.executeQuery(query);
		        ResultSetMetaData rsmd = rs.getMetaData();
		        int columnsNumber = rsmd.getColumnCount();
		        while (rs.next()) {
		        	 Dumpster  dumpster = new Dumpster();
		        	 dumpster.setId(rs.getInt("id"));
		        	 dumpster.setDeviceID(rs.getString("device_id"));
		        	 dumpster.setIdDumpsterType(rs.getInt("id_dumpster_type"));
		        	 dumpster.setIdPhysicalState(rs.getInt("id_physical_state"));
		        	 //dumpster.setLocation(new Geometry());
		        	 //rs.getString("location");
		        	 dumpster.setVia(rs.getInt("idvia"));
		        	 System.out.println(dumpster.toString());
		        }
		    } catch (SQLException e ) {
		       e.printStackTrace();
		    } finally {
		        if (stmt != null) { stmt.close(); }
		        if (rs != null) { rs.close(); }
		        if (con != null) { con.close(); }
		    }
		}

}
